<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Information</title>

    <!-- Placeholder link to React / Bootstrap -->

    <!-- Link local CSS Sheet -->


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="/css/style.css">

    <style>
        /* Customize table-active class for light yellow background */
        .table-active {
            background-color: #d3b140 !important; /* Light yellow */
            --bs-table-bg-state: rgb(166, 166, 255);
        }
        body{
            /* background-color: rgb(196, 225, 255); */
        }
         /* Highlight cells in light pink */
         .highlight-pink {
            background-color: #f2c4c4 !important; /* Light pink */
        }
        /* Toast top right */
        .toast-container {
            position: fixed;
            top: 10%;
            right: 5%;
        }
        /* Custom background for the toast */
        .toast-light-blue {
            background-color: #c4f6ff !important; /* Light blue */
            color: #0c5460; /* Dark text to match light blue */
            box-shadow: 0 8px 10px rgba(0, 0, 0, 0.4), 0 6px 20px rgba(0, 0, 0, 0.39); /* Drop shadow */

        }
        /* Breathing glow effect for input field */
        @keyframes breathingGlow {
            0% {
                box-shadow: 0 0 10px rgba(0, 38, 255, 0.5);
            }
            50% {
                box-shadow: 0 0 30px rgba(0, 38, 255, 0.9);
            }
            100% {
                box-shadow: 0 0 10px rgba(0, 38, 255, 0.5);
            }
        }
        .glow-input {
            animation: breathingGlow 2s infinite;
            border: 1px solid rgba(0, 38, 255, 0.5);
        }

        /* Row slide-down animation */
        @keyframes slideDown {
            0% {
                transform: translateY(-20px);
                opacity: 0;
            }
            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }
        .slide-down {
            animation: slideDown 0.5s ease-out;
        }
        .non-selectable {
            background-color: #7314144c !important; /* Light pink for non-selectable rows */
            pointer-events: none; /*  Disable Selection */
        }
        /* Strobe and glow animation for "Scheduled" cells */
        @keyframes strobeGlow {
            0%, 100% {
                box-shadow: 0 0 10px rgba(255, 0, 0, 0.5), 0 0 20px rgba(255, 0, 0, 0.8);
                background-color: #ffe6e6;
            }
            50% {
                box-shadow: 0 0 20px rgba(255, 0, 0, 1), 0 0 40px rgba(255, 0, 0, 1);
                background-color: #ffcccc;
            }
        }
        .strobe-glow {
            animation: strobeGlow 2s infinite;
        }        


    </style>


<script>
    function logoutUser() {
      // Clear saved login info
      localStorage.removeItem('user');
  
      // Optional: Clear sessionStorage or cookies if used
      // sessionStorage.clear();
  
      // Redirect to login page
      window.location.href = 'Login.html';
    }
  </script>
</head>
<body>

    <!-- Main page header -->
    <div class="page-header" style="padding-top: 15px;">
        <img src="/img/fleetpay_dark.jpg" alt="" style="height: 50px;">
        <p style="font-size: 14px;">Sql Database Testing Environment</p>
    </div>

    
    <br><br>
    <!-- Toggle Button -->
    <button id="toggleSidebar" class="btn btn-secondary" style="position: fixed; top: 20px; left: 20px; z-index: 999; background-color: #0e6170;">
        <i class="fas fa-bars"></i>
    </button>
  

    <!-- Sidebar -->
    <!-- Font Awesome CDN for icons (add in <head> if not already included) -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

        <div class="sidebar" id="sidebar">

            <div class="sidebar-content">
              <br><br>
              <h3 class="section-header" style="text-align: center; text-decoration: wavy;">Main Menu</h3><br>
              <a href="Dashboard.html" style="text-align: center; background-color: #416682;"><strong>ðŸ’¸ My Dashboard</strong></a>
              <hr  class="section-header">
              <h6 class="section-header" style="color: lightgray; font-weight: bolder;">Requests</h6>

              <a href="CreateRequest.html" style="background-color: #035b6a;">ðŸ”¸Create Request</a>
              <a href="ReviewRequest.html">ðŸ”¸Review Requests</a>
              <a href="ReportIssue.html">ðŸ”¸Help or Report Issue</a>

              <h6 class="section-header" style="color: lightgray; font-weight: bolder;">Management</h6>

              <a href="CompaniesAdmin.html">ðŸ”¸Company Admin</a>
              <a href="UsersAdmin.html">ðŸ”¸User Admin</a>
              <a href="BankLinking.html">ðŸ”¸Banking Admin</a>
              <h6 class="section-header" style="color: lightgray; font-weight: bolder;">Financial Records</h6>

              <a href="Payrollexclude.html">ðŸ”¸Payroll Exclusions</a>
              <a href="ArchiveRecords.html">ðŸ”¸Payout Archives</a>
              <a href="settings.html">ðŸ”¸Settings</a>
              <a href="contact.html"> ðŸ”¸More Info</a>

            </div>
          
            <!-- Moved to bottom -->
            <div class="user-panel">
              <i class="fas fa-user-circle fa-2x me-2"></i>
              
            <div class="user-info">
                <div><strong>Jake W.</strong></div>
                <div style="font-size: 0.85em;">
                    <i class="fas fa-badge-check" style="color: limegreen;"></i> Verified
                  </div>
                </div>

            <div class="user-actions">
                <i class="fas fa-cog mx-2" title="Settings"></i>
                <i class="fas fa-sign-out-alt" title="Logout" onclick="logoutUser()" style="cursor: pointer;"></i>
            </div>
            </div>

          </div>

          <div style="margin-left: 300px; margin-top: 48px;">
            <h2 style="color: rgb(187, 187, 187);">Create a New Company or Subcontractor Group</h2>
            <p style="color: white;">Current Fleetpay Instance: <span style="color: rgb(107, 251, 189); font-weight: bold;">SUDO</span></p>
            <hr style="color: white; width: 85%;">
            <p style="color: white; width: 80%;">Please note that a company must be created before its respective users can be created, even in the case of single person sole proprietorships. Direct Company employees can be added underneath the highest parent in a group. Example: Incredible Installations would be the parent company for Luke Grant. </p>
            <p style="color: white; width: 80%;">For more information and FAQ, please visit our <a href="ReportIssue.html" style="color: rgb(188, 171, 240);">Help Page</a>
        </div>
          

        <div class="card text-white bg-secondary shadow-sm my-4" style="max-width: 1320px; margin-right: 120px; border-radius: 1rem; margin-left: 300px;">
            <div class="row g-0">
              
              <!-- Left: Text Content -->
              <div class="col-md-7 p-4 d-flex flex-column justify-content-center">
                <h4 class="card-title">
                   Coming Soon: The FleetPay Card ðŸ’³
                </h4>
                <p class="card-text">
                  Discover the upcoming FleetPay Card â€” designed to make your payouts faster, your transactions smoother, and your funds more accessible than ever before.
                </p>
                <p class="card-text">Check your email for notifications soon about the FleePay Card and additional offers.</p>
                <button class="btn btn-light btn-sm mt-2 disabled" style="pointer-events: none; font-weight: bold;">Launching Soon</button>
              </div>
          
              <!-- Right: Promo Image -->
              <div class="col-md-5 d-flex align-items-center justify-content-center p-3">
                <img src="/img/pngimg.com - credit_card_PNG99 (1).png" alt="FleetPay Card Preview" class="img-fluid rounded shadow" style="max-height: 200px;">
              </div>
          
            </div>
          </div>

    <div class="container" id="maincontain" 
    style="background-color: 97c5db; width: 75%; 
      margin-left: 300px; align-items: center;">
        <br>



            <div class="row mb-4" style="padding-left: 20px;padding-right: 20px;">
                <!-- Left Card: Job Source Info -->
                <div class="col-md-6">
                  <div class="card shadow-sm h-100">
                    <div class="card-body d-flex align-items-center justify-content-between">
                      <h5 class="mb-0">Your Job Source: <br><span class="text-muted">Incredible / PF</span></h5>
                      <img src="/img/logos-customer-projectsforce.png" alt="Job Source Logo" style="height: 40px;">
                    </div>
                  </div>
                </div>
              
                <!-- Right Card: Help Prompt -->
                <div class="col-md-6">
                  <div class="card shadow-sm h-100">
                    <div class="card-body d-flex align-items-center justify-content-center">
                      <p class="mb-0 text-center">
                        <strong>Not your job source or need to add another?</strong><br>
                        <a href="ReportIssue.html" class="text-primary fw-bold">Use Our Help Page</a>
                      </p>
                    </div>
                  </div>
                </div>
              </div>
              







        <div class="row" style="margin-top: 2px;">

        <!-- <hr> -->
        <div class="container mt-5" style="background-color: #e2eeff; margin-top: 5px;">
            <h1 class="text-center mb-4">Create Payment Request</h1>
            <div class="card">
                <div class="card-body">
                    <form id="uploadForm">
                        <div class="mb-3">
                            <label for="fileInput" class="form-label">Choose a Job payout file </label>
                            <p>[  Note: This process will auto populate per installer, no selection in real time  ]</p>
                            <input class="form-control" type="file" id="fileInput" accept=".xlsx">
                        </div>
                        <button type="button" class="btn btn-secondary" id="parseButton">Load My Jobs</button>
                    </form>
                </div>
            </div>
            <div class="mt-4">
                <h3>Job Data</h3>
                <p>Please review and select your completed jobs from the table below. Please note, if a job is still
                     in a status of "Scheduled", it will not be approved for payout. These jobs will be hightlighted i
                    n Red. We encourage you to use the included link to the job and perform necessary actions to bring it to a close and
                     make it available for payout. 
                </p>
                <button class="btn btn-secondary mb-3" id="selectAllButton">Select All Jobs</button>
                <button class="btn btn-secondary mb-3 ms-2" id="selectNoneButton">Select None</button>
                <table class="table table-bordered table-striped" id="xlsxTable">
                    <thead id="tableHead"></thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
            <div class="mt-4">
                <label for="totalField" class="form-label">Total Selected Labor:</label>
                <input type="text" id="totalField" class="form-control" readonly>
            </div>
            <div class="mt-3">
                <label for="percentageField" class="form-label">Fleetpay Immediate Payout amount:</label>
                <input type="text" id="percentageField" class="form-control" readonly>
            </div>

            <!-- <button type="button" class="btn btn-primary mt-3" id="insertButton">Insert Selected Rows into Database</button> -->
<hr>

            <div class="mt-4 text-center">
                <button class="btn btn-secondary" id="googleButton" style="height: 55px; width: 30%;" data-bs-toggle="modal" data-bs-target="#googleModal">Submit for Payment</button>
            <br><br>
            </div>
        </div>


    
        <!-- <hr> -->
        <br><br><br>
    
        <!-- Modal -->
        <div class="modal fade" id="googleModal" tabindex="-1" aria-labelledby="googleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="googleModalLabel">Request Submission</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        Please review your amount before submitting a payment request. We will review and send you correspondance on your deposit to your email account shortly. 
                        <hr>
                        <div class="mb-3">
                            <label for="modalPercentageField" class="form-label" style="font-weight:bold;">Your Deposit Amount:</label>
                            <input type="text" style="font-weight: bold; text-align: center;" id="modalPercentageField" class="form-control glow-input" readonly>
                        </div>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" id="approveButton" data-bs-dismiss="modal">Submit Request</button>
                    </div>
                </div>
            </div>
        </div>
    
    
         <!-- Success Toast -->
         <div class="toast-container position-fixed bottom-0 end-0 p-3">
            <div id="successToast" class="toast align-items-center toast-light-blue border-0" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="d-flex">
                    <div class="toast-body">
                        <strong>âœ… Request Submitted Successfully</strong>
                        <hr>
                        Receipt will be emailed with all information
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            </div>
        </div>

        </div>
    </div>


    <div id="myfooter">

        <br>
        <div class="text-center">
          <hr style="color: white; width: 70%; margin-left: 300px; align-content: center;">
        </div>
        <div class="text-center" style="font-size: large; color: rgb(192, 191, 191); font-weight: bold;">Fleetpay.cash â€” A GenX Company â€” Ellis Ventures 2025 ~ JW</div>
        <br><br>
        
      </div>


</body>
    

    <!-- ================== JAIL TO RESEARCH ======================= -->
    <!-- =========================================================== -->



    <script>
        async function fetchAllCustomers() {
            try {
                // Fetch all records from the server
                const response = await fetch('http://localhost:3000/api/lowes');
                const customers = await response.json();

                const recordsContainer = document.getElementById('records-container');

                // Clear existing records
                recordsContainer.innerHTML = '<h3>All Customers</h3><p>Click on a customer to view their details above:</p>';

                // Populate the records container
                customers.forEach(customer => {
                    const recordDiv = document.createElement('div');
                    recordDiv.classList.add('record');
                    recordDiv.textContent = `${customer.customer_first_name} ${customer.customer_last_name}`;
                    
                    // Add a click event listener to populate fields
                    recordDiv.addEventListener('click', () => {
                        document.getElementById('customer-id').textContent = customer.customer_id;
                        document.getElementById('customer-first-name').textContent = customer.customer_first_name;
                        document.getElementById('customer-last-name').textContent = customer.customer_last_name;
                        document.getElementById('customer-email').textContent = customer.customer_email;
                        document.getElementById('customer-phone').textContent = customer.customer_phone;
                        document.getElementById('delete-button').style.display = 'block';
                        document.getElementById('delete-button').dataset.customerId = customer.customer_id; // Store customer ID in the button
                    });

                    recordsContainer.appendChild(recordDiv);
                });
            } catch (error) {
                console.error('Error fetching customers:', error);
                alert('Failed to load customer records.');
            }
        }



        async function deleteCustomer(customerId) {
            try {
                const response = await fetch(`http://localhost:3000/api/delete-customer/${customerId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    // alert('Customer deleted successfully!');
                    fetchAllCustomers(); // Refresh the list of customers
                    document.getElementById('customer-id').textContent = 'Click a record below';
                    document.getElementById('customer-first-name').textContent = 'Click a record below';
                    document.getElementById('customer-last-name').textContent = 'Click a record below';
                    document.getElementById('customer-email').textContent = 'Click a record below';
                    document.getElementById('customer-phone').textContent = 'Click a record below';
                    document.getElementById('delete-button').style.display = 'none';
                } else {
                    const error = await response.json();
                    alert('Failed to delete customer: ' + error.message);
                }
            } catch (error) {
                console.error('Error deleting customer: ', error);
                alert('An error occurred while deleting the customer.');
            }
        }

         // Attach click event to the delete button
         document.getElementById('delete-button').addEventListener('click', () => {
            const customerId = document.getElementById('delete-button').dataset.customerId;
            if (customerId && confirm('Are you sure you want to delete this record?')) {
                deleteCustomer(customerId);
            }
        });

        // Fetch all customers on page load
        fetchAllCustomers();
    </script>

    <!-- ================== END JAIL RESEARCH ======================= -->
    <!-- ============================================================ -->
    






    <!--      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~      -->
    <!--                ALL SCRIPT REFERENCE FILES BELOW              -->
    <!--      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~      -->

    
    <!-- Link to the script to fetch and display data -->
    <script src="app.js"></script>

    <!-- Link to Request Script -->
    <script src="/javascript/request.js"></script>


    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- SheetJS Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    
    <!-- JavaScript for Reset -->
    <script>

    // Update modal's percentage field before opening
        document.getElementById('googleButton').addEventListener('click', function () {
            const percentageField = document.getElementById('percentageField').value;
            document.getElementById('modalPercentageField').value = percentageField || 'N/A';
        });
        // Clear the table and reset the form when "Approve" is clicked
        document.getElementById('approveButton').addEventListener('click', function () {
            insertRequest();
        });
        // Additional JavaScript for table parsing remains unchanged
    </script>

    <!-- Javascript to toggle sidebar -->
    <script>
        document.getElementById('toggleSidebar').addEventListener('click', () => {
        const sidebar = document.getElementById('sidebar');
        sidebar.classList.toggle('collapsed');
        });
    </script>
  



    

    <!--      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~      -->
    <!--        Insert Rows into Database for Payroll Exclusion       -->
    <!--      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~      -->

<script>
        
        document.getElementById('insertButton').addEventListener('click', function () {
        const selectedRows = document.querySelectorAll('#tableBody .table-active');
        if (selectedRows.length === 0) {
            alert('No rows selected for insertion.');
            return;
        }

        // Map table headers
        const headers = [
            "requestId",       // Constant value
            "projectNumber",
            "customerName",
            "installDate",
            "totalLabor",
            "status",
            "jobLink"
        ];

        selectedRows.forEach(row => {
            const cells = Array.from(row.querySelectorAll('td'));
            const rowData = { requestId: "0002" }; // Set constant requestId

            // Map headers to cell values
            cells.forEach((cell, index) => {
                rowData[headers[index + 1]] = cell.textContent.trim(); // Skip requestId
            });

            // Example API call to insert row into the SQL database
            try{
            const response = fetch('http://localhost:3000/insert-row', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(rowData),
            })
            .then(response => {
                if (response.ok) {
                    console.log('Row inserted successfully:', rowData);
                } else {
                    console.error('Failed to insert row:', rowData);
                }
            })
            
        } catch(err){
            console.error(err);
        }
            
        });

        alert('Selected rows have been submitted for insertion.');
    });
</script>


</html>


 
